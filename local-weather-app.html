<!DOCTYPE html>
<html lang="en">
<head>
    <title>Local Weather App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
    <style>

        html{
            font-size: 18px;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: url("http://static.pexels.com/wp-content/uploads/2014/06/clouds-colorful-colourful-1029.jpg") no-repeat;
            background-size: cover;
        }

        body {
            font-family: 'Lato', sans-serif;
            text-align: center;
            font-size: 1em;
        }

        #title{
            font-size: 1.8em;
            padding: 1%;
            color: #BFAD61;
            text-shadow: 0 0 0.3em #000;
        }

        #subtitle{
            font-size: 1.5em;
            margin-bottom: 3%;
            color: #BFAD61;
            text-shadow: 0 0 0.3em #000;
        }


        #loadingGif {
            display: block;
            margin:0 auto;
            height: 32px;
            width: 32px;
            background-image: url("http://i.imgur.com/g6fBUAd.gif");
        }


        #icon, #temp{
            display: inline-block;
        }

        img{
            vertical-align: middle;
        }

        #icon{
            position: relative;
            bottom: 5px;
        }

        #temp{
            font-size: 1.8em;
            font-weight: bold;
            padding-bottom: 1%;
            color: #ffffff;
            text-shadow: 0 0 0.2em #333;
        }

        .location, #conditions, #wind{
            display: inline-block;
        }

        .details{
            border: 2px solid #ffffff;
            color: #7F3320;
            padding: 2% 1% 2% 1%;
            margin: 0 auto 0.7% auto;
            background-color: #ffffff;
            border-radius: 0.3em;
            box-shadow: .2em .2em .2em #444;
            opacity: 0.7;
        }

        #postal {
            font-size: 1.8em;
            font-weight: bold;
            padding-top: 3%;
            color: #ffffff;
            text-shadow: 0 0 0.2em #333;
        }

        button{
            margin-top: 3%;
            font-size: 1.15em;
            border: 0.1em solid #ffffff;
            border-radius: 0.2em;
            background-color: #7F3320;
            color: #ffffff;
            padding: 0.5%;
        }

    </style>
</head>
<body>
<!--FreeCodeCamp.com Zipline task demo of a local weather app.
It uses two api queries to gather local information, and display the local weather conditions.
Code by Suzanne Atkinson(@adventurebear), styling by Julie Myers (@blueoceanview) on freecode.slack.com

Other resources:
Country Codes for imperial vs. metric check:
http://en.wikipedia.org/wiki/ISO_3166-1#Current_codes

List of countries that use fahrenheight:
http://en.wikipedia.org/wiki/Fahrenheit
-->


<div id="title">Free Code Camp Zipline</div>
<div id="subtitle">Local Weather App</div>

<!--<div id="loadingGif"></div>-->

<div id="iconTemp">
    <div id="icon"></div>
    <div id="temp"></div>
</div>

<div id="weatherWrapper">
    <div class="location details"></div>
    <div id="conditions" class="details"></div>
    <div id="wind" class="details"></div>
    <div id="postal"></div>
</div>

<!--<button>Convert Units</button>-->

<script>
    $(document).ready(function() {

        getLocation();

        function getLocation() {
            $.get("http://ipinfo.io", function(location) {
                console.log(location);

                $('.location')
                        .append(location.city + ", ")
                        .append(location.region);

                var units = getUnits(location.country);
                getWeather(location.loc, units);

                //return weather;

            }, "jsonp");

        }

        function getWeather(loc, units) {
            lat = loc.split(",")[0] //.toString();
            lon = loc.split(",")[1] //.toString();

            var weatherApiUrl = 'http://api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + "&units=" + units;

            console.log(weatherApiUrl);

            $.get(weatherApiUrl, function(weather) {
                var windDir = convertWindDirection(weather.wind.deg);
                var temperature = weather.main.temp;
                var unitLabel;

                //label based in imperial vs metric units
                if (units === "imperial") {
                    unitLabel = "F";
                } else {
                    unitLabel = "C";
                }

                temperature = parseFloat((temperature).toFixed(1));

                console.log(weather);

                $('#icon')
                        .append("<img src='http://openweathermap.org/img/w/" + weather.weather[0].icon + ".png'>");

                $('#temp').append(temperature + " " + unitLabel);
                $('#conditions').append(weather.weather[0].description);
                $('#wind').append(windDir + " " + weather.wind.speed + " knots");
                $('#postal').append(postal);

            }, "jsonp");

        };

        function convertWindDirection(dir) {
            var rose = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            var eightPoint = Math.floor(dir / 45);
            return rose[eightPoint];
        }

        function getUnits(country) {
            var imperialCountries = ['US', 'BS', 'BZ', 'KY', 'PW'];

            if (imperialCountries.indexOf(country) === -1) {
                var units = 'metric';
            } else {
                units = 'imperial';
            }

            console.log(country, units);
            return units;
        }

    });

</script>
</body>
</html>